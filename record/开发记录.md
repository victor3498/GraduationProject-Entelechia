## 2026/1/28之前
基本后端框架构建，前端tiptap基本做了了解，简易富文本编辑器搭载；后端建表语句记录如下：
用户表 users
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

文档表 documents（核心）
CREATE TABLE documents (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL,
  title VARCHAR(255),
  content JSONB NOT NULL,
  is_starred BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  CONSTRAINT fk_user
    FOREIGN KEY (user_id)
    REFERENCES users(id)
    ON DELETE CASCADE
);

用户文档状态表（上一次打开文档）
CREATE TABLE user_preferences (
  user_id INTEGER PRIMARY KEY,
  last_opened_doc_id INTEGER,

  CONSTRAINT fk_pref_user
    FOREIGN KEY (user_id)
    REFERENCES users(id)
    ON DELETE CASCADE
);

## 2026/1/28
   目前在做用户登录认证这一块，
   现在的问题：注册时id没有生成一并插入，对于接下来的流程（登录之后id如何传递，多个访问时怎样承担的）等并不了解，以及这个后端架构能不能支撑的住访问并发之类的（觉得这个东西目前太简单了）

## 2026/1/29
   看得头大，数据库白学了全完了，神马密码哈希了存进去大坏事，登录都登不明白
   重置了数据库表，userid处换了uuid，今天到这算了

## 2026/1/30
  基本的登录，修改密码功能实现，准备之后升级token认证为访问token与刷新token

## 2026/1/31
    基本实现双token，尚未测试

## 2026/2/2
    记录现在的建表语句
    CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE documents (
  id SERIAL PRIMARY KEY,
  user_id UUID NOT NULL,
  title VARCHAR(255),
  content JSONB NOT NULL,
  is_starred BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  CONSTRAINT fk_documents_user
    FOREIGN KEY (user_id)
    REFERENCES users(id)
    ON DELETE CASCADE
);

CREATE TABLE user_preferences (
  user_id UUID PRIMARY KEY,
  last_opened_doc_id INTEGER,

  CONSTRAINT fk_pref_user
    FOREIGN KEY (user_id)
    REFERENCES users(id)
    ON DELETE CASCADE,

  CONSTRAINT fk_pref_doc
    FOREIGN KEY (last_opened_doc_id)
    REFERENCES documents(id)
    ON DELETE SET NULL
);


文档模块初步完成未有测试

## 2026/2/3
    测试功能。查询功能中对星标的查询有问题，具体相关内容在apifox上保存，现此处再附一份
      http://localhost:3000/api/doc
      | 功能        | Method | URL                | 是否登录 |
| --------- | ------ | ------------------ | ---- |
| 新建文档      | POST   | `/doc`             | ✅    |
| 删除文档      | DELETE | `/doc/:id`         | ✅    |
| 重命名文档     | PATCH  | `/doc/:id/title`   | ✅    |
| 保存 / 更新内容 | PUT    | `/doc/:id/content` | ✅    |
| 获取文档列表    | GET    | `/doc`             | ✅    |
| 查询文档      | GET    | `/doc/search`      | ✅    |
| 获取文档详情    | GET    | `/doc/:id`         | ✅    |
| 星标 / 取消星标 | PATCH  | `/doc/:id/star`    | ✅    |


保存 / 更新文档内容（核心）
PUT /api/doc/:id/content
Body
{
  "content": {
    "type": "doc",
    "content": [
      {
        "type": "paragraph",
        "content": [
          { "type": "text", "text": "这是新的内容" }
        ]
      }
    ]
  }
}


重命名文档
PATCH /api/doc/:id/title
Body
{
  "title": "新的文档标题"
}

星标 / 取消星标
PATCH /api/doc/:id/star
Body（星标）
{
  "isStarred": true
}

Body（取消星标）
{
  "isStarred": false
}

查询文档（搜索 / 星标）
GET /api/doc/search
示例 1：标题搜索
GET /api/doc/search?keyword=第一

示例 2：只看星标
GET /api/doc/search?isStarred=true

示例 3：组合
GET /api/doc/search?keyword=项目&isStarred=true


   

   